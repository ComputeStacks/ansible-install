---
##
# Install Google Cloud Repo
# This will authenticate with our container registry, and allow you to send us diagnostic files.
- name: Install Google Cloud Repo
  template:
    src: google-cloud-sdk.repo.j2
    dest: /etc/yum.repos.d/google-cloud-sdk.repo

- name: Install gcloud
  yum:
    name: google-cloud-sdk
    state: latest
    update_cache: true

- name: Upload gcloud auth file
  copy:
    src: "{{ lookup('env','PWD') }}/gcloud-auth.json"
    dest: /root/.gcloud-auth.json
    owner: root
    group: root
    mode: '0400'

- name: Authenticate with Google
  shell: "gcloud auth activate-service-account --key-file /root/.gcloud-auth.json"
  args:
    executable: /bin/bash

